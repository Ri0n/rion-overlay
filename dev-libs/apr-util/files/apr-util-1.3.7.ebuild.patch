--- /usr/portage/dev-libs/apr-util/apr-util-1.3.7.ebuild	2009-06-21 16:35:27.000000000 +0200
+++ apr-util-1.3.9-r100.ebuild	2009-06-22 19:05:10.610878001 +0200
@@ -8,7 +8,7 @@
 #APR_PV=${PV}
 APR_PV="1.3.5"
 
-inherit db-use libtool multilib
+inherit db-use autotools multilib
 
 DESCRIPTION="Apache Portable Runtime Utility Library"
 HOMEPAGE="http://apr.apache.org/"
@@ -17,7 +17,7 @@
 LICENSE="Apache-2.0"
 SLOT="1"
 KEYWORDS="alpha amd64 arm hppa ia64 ~mips ppc ppc64 s390 sh sparc ~sparc-fbsd x86 ~x86-fbsd"
-IUSE="berkdb doc freetds gdbm ldap mysql odbc postgres sqlite sqlite3"
+IUSE="berkdb doc freetds gdbm ldap mozldap mysql odbc postgres sqlite sqlite3"
 RESTRICT="test"
 
 RDEPEND="dev-libs/expat
@@ -26,6 +26,9 @@
 	freetds? ( dev-db/freetds )
 	gdbm? ( sys-libs/gdbm )
 	ldap? ( =net-nds/openldap-2* )
+	mozldap? ( =dev-libs/mozldap-6*
+		  =dev-libs/nspr-4*
+		  =dev-libs/nss-3* )
 	mysql? ( =virtual/mysql-5* )
 	odbc? ( dev-db/unixODBC )
 	postgres? ( virtual/postgresql-base )
@@ -35,7 +38,8 @@
 	doc? ( app-doc/doxygen )"
 
 src_prepare() {
-	elibtoolize
+	epatch "${FILESDIR}"/"${PN}"-1.3.7-mozldap60-5.patch
+	eautoreconf
 }
 
 src_configure() {
@@ -43,6 +47,11 @@
 
 	use ldap && myconf+=" --with-ldap"
 
+	use mozldap && myconf="${myconf} --with-ldap \
+					 --with-lber=lber60
+					 --with-ldap-include=/usr/include/mozldap/ \
+					 --with-ldap-lib=/usr/$(get_libdir)/mozldap/ "
+
 	if use berkdb; then
 		local db_version
 		db_version="$(db_findver sys-libs/db)" || die "Unable to find db version"
