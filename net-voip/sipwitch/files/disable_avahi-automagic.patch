--- configure.ac.orig	2011-05-16 01:10:44.000000000 +0300
+++ configure.ac	2011-05-16 01:14:00.000000000 +0300
@@ -30,6 +30,31 @@
 AC_C_VOLATILE
 AC_C_INLINE
 
+dnl slepnoga: Detect Gentoo/OpenRC
+
+if test x"$osname" = x ; then
+    if test -f /etc/fedora-release ; then
+        osname="fedora"
+    elif test -f /etc/redhat-release ; then
+        osname="redhat"
+    elif test -f /etc/SuSE-release ; then
+        osname="suse"
+    elif test -f /etc/debian_version ; then
+        osname="debian"
+    elif test -f /etc/gentoo-release ; then
+        osname="gentoo"
+    fi
+
+    AC_MSG_NOTICE([Detected operating system type: $osname])
+fi
+
+AM_CONDITIONAL([HAVE_FEDORA], [test x"$osname" = xfedora])
+AM_CONDITIONAL([HAVE_REDHAT], [test x"$osname" = xredhat])
+AM_CONDITIONAL([HAVE_SUSE], [test x"$osname" = xsuse])
+AM_CONDITIONAL([HAVE_DEBIAN], [test x"$osname" = xdebian])
+AM_CONDITIONAL([HAVE_GENTOO], [test x"$osname" = xgentoo])
+
+
 if test -z "$PKG_CONFIG_PATH" ; then
     case "$prefix" in
     NONE|/usr/local|/usr)
@@ -342,13 +367,16 @@
 
 zeroconf=""
 ZEROCONF_LIBS=""
-if test -z "$zeroconf" ; then
+AC_ARG_ENABLE(zeroconf,
+    AC_HELP_STRING([--enable-zeroconf],[enable zeroconf support]),[
+
+if test  "$enable_zeroconf" != "xNO" ; then
     PKG_CHECK_MODULES(ZEROCONF, avahi-client > 0.3, [
         AC_DEFINE(ZEROCONF_AVAHI, 1, [zeroconf avahi client])
         zeroconf="avahi"
     ],[zeroconf="$zeroconf"])
 fi
-
+])
 AH_BOTTOM([
 #ifndef HAVE_LOCALTIME_R
 #define localtime_r(x, y)   localtime(x)
